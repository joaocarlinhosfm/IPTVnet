<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#141414">
    <title>N-STREAM Ultimate UI</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --red: #E50914; --black: #141414; --dark-gray: #1f1f1f; }
        body { margin: 0; font-family: 'Montserrat', sans-serif; background: var(--black); color: white; overflow-x: hidden; }
        
        /* --- 1. NAVBAR GLASSMORPHISM --- */
        header { 
            position: fixed; top: 0; width: 100%; height: 70px; 
            /* Efeito de vidro fosco */
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex; align-items: center; justify-content: space-between; padding: 0 4%; z-index: 2000;
            transition: 0.3s;
        }
        .logo { color: var(--red); font-weight: 900; font-size: 1.5rem; letter-spacing: -1px; text-shadow: 0 0 20px rgba(229, 9, 20, 0.4); }
        .search-box {
            background: rgba(255,255,255,0.1); border: 1px solid transparent; color: white;
            padding: 10px 20px; border-radius: 30px; width: 35%; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .search-box:focus { width: 55%; outline: none; border-color: var(--red); background: rgba(0,0,0,0.5); box-shadow: 0 0 15px rgba(229, 9, 20, 0.3); }

        /* --- 2. HERO SECTION DINÂMICA --- */
        #hero-featured {
            height: 65vh; position: relative; display: none; /* Escondido até haver canais */
            align-items: flex-end; padding: 0 4% 60px 4%;
            background: linear-gradient(to top, var(--black) 10%, transparent 90%),
                        linear-gradient(to right, rgba(0,0,0,0.8) 30%, transparent),
                        url('https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?auto=format&fit=crop&w=1920&q=80') center/cover no-repeat;
        }
        .hero-content { max-width: 600px; animation: fadeUp 1s ease forwards; opacity: 0; }
        .hero-tag { color: var(--red); font-weight: 800; font-size: 0.9rem; margin-bottom: 10px; display: block; }
        .hero-title { font-size: 3rem; font-weight: 900; line-height: 1.1; margin: 0 0 20px 0; text-transform: uppercase; }
        .btn-play {
            background: var(--red); color: white; padding: 12px 35px; border: none; border-radius: 4px;
            font-weight: 800; font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; gap: 10px;
            transition: 0.3s; box-shadow: 0 0 30px rgba(229, 9, 20, 0.4);
        }
        .btn-play:hover { transform: scale(1.05); background: white; color: var(--black); }

        /* --- 3. LISTAS E CARTÕES (COM ANIMAÇÃO) --- */
        .content { padding-top: 20px; padding-bottom: 50px; }
        .row { margin-bottom: 40px; padding-left: 4%; opacity: 0; animation: fadeUp 0.8s ease forwards; }
        /* Atrasa a animação de cada linha sucessiva para um efeito cascata */
        .row:nth-child(1) { animation-delay: 0.1s; }
        .row:nth-child(2) { animation-delay: 0.2s; }
        .row:nth-child(3) { animation-delay: 0.3s; }
        .row:nth-child(4) { animation-delay: 0.4s; }

        .row-title { font-size: 1.3rem; font-weight: 700; margin-bottom: 15px; color: #e5e5e5; }
        .carousel { display: flex; overflow-x: auto; gap: 12px; scrollbar-width: none; padding: 10px 0 20px 0; }
        .carousel::-webkit-scrollbar { display: none; }

        .card { 
            flex: 0 0 150px; height: 220px; 
            background: #0a0a0a; border-radius: 8px; 
            position: relative; cursor: pointer; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid transparent; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }
        /* Efeito Hover: Escala e Brilho Vermelho */
        .card:hover { transform: scale(1.1) translateY(-5px); z-index: 10; border-color: var(--red); box-shadow: 0 10px 25px -5px rgba(229, 9, 20, 0.5); }
        .card img { width: 85%; height: 85%; object-fit: contain; transition: 0.3s; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.5)); }
        
        .card-info { 
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 15px 10px;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 20%, transparent);
            font-size: 0.8rem; font-weight: 700; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            transform: translateY(100%); transition: 0.3s; /* Escondido por defeito */
        }
        .card:hover .card-info { transform: translateY(0); /* Aparece no hover */ }

        /* PLACEHOLDER BONITO */
        .placeholder-icon { font-size: 3rem; color: #333; }

        /* --- MODAL MELHORADO --- */
        #config-modal { 
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);
            z-index: 3000; justify-content: center; align-items: center; animation: fadeIn 0.3s ease;
        }
        .modal-content { background: var(--dark-gray); padding: 40px; border-radius: 12px; width: 90%; max-width: 500px; text-align: center; border: 1px solid #333; box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        input[type="text"] { width: 100%; padding: 15px; margin: 20px 0; border-radius: 6px; border: 1px solid #444; background: #111; color: white; font-family: inherit; }
        .btn { background: var(--red); color: white; padding: 15px 40px; border: none; border-radius: 6px; font-weight: 800; cursor: pointer; transition: 0.3s; width: 100%; }
        .btn:hover { background: white; color: var(--red); }
        .btn-outline { background: transparent; border: 2px solid #444; margin-top: 15px; }
        .btn-outline:hover { border-color: white; }

        /* ANIMATIONS */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <header id="navbar">
        <div class="logo">N-STREAM</div>
        <input type="text" id="search" class="search-box" placeholder="Pesquisar..." oninput="filterChannels()">
        <i class="fas fa-sliders-h" onclick="toggleModal(true)" style="cursor:pointer; font-size: 1.4rem; color: #ddd; transition: 0.3s;"></i>
    </header>

    <div id="hero-featured">
        <div class="hero-content">
            <span class="hero-tag">SUGESTÃO DO MOMENTO</span>
            <h1 class="hero-title" id="hero-channel-name">Carregando...</h1>
            <button class="btn-play" id="hero-play-btn">
                <i class="fas fa-play"></i> VER AGORA
            </button>
        </div>
    </div>

    <div id="content" class="content"></div>

    <div id="config-modal" style="display: flex;"> <div class="modal-content">
            <h2 style="font-weight: 900; font-size: 1.8rem; margin-bottom: 10px;">BEM-VINDO</h2>
            <p style="color: #aaa; margin-bottom: 30px;">Para começar, precisamos da tua lista de canais.</p>
            
            <button class="btn" onclick="document.getElementById('file-input').click()">
                <i class="fas fa-file-upload" style="margin-right: 10px;"></i> CARREGAR FICHEIRO .M3U
            </button>
            <input type="file" id="file-input" style="display:none" onchange="loadFromFile(event)">

            <div style="margin: 25px 0; position: relative; height: 1px; background: #333;">
                <span style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--dark-gray); padding: 0 10px; color: #666; font-size: 0.8rem;">OU USA UM LINK (BETA)</span>
            </div>
             <input type="text" id="m3u-url" placeholder="https://exemplo.com/lista.m3u">
             <button class="btn btn-outline" onclick="loadFromUrl()">TENTAR LINK</button>

             <p style="margin-top: 30px; color: #666; cursor: pointer; font-size: 0.9rem;" onclick="toggleModal(false)" id="close-modal-btn">Fechar</p>
        </div>
    </div>

    <script>
        let allChannels = JSON.parse(localStorage.getItem('my_channels')) || [];

        window.onload = () => {
            if (allChannels.length === 0) {
                toggleModal(true);
                document.getElementById('close-modal-btn').style.display = 'none'; // Não deixar fechar se não houver canais
            } else {
                toggleModal(false);
                initApp(allChannels);
            }
        };

        // Função principal que arranca a app depois de ter dados
        function initApp(data) {
            render(data);
            setupHero(data);
        }

        function toggleModal(show) {
             const modal = document.getElementById('config-modal');
             modal.style.display = show ? 'flex' : 'none';
             if(allChannels.length > 0) document.getElementById('close-modal-btn').style.display = 'block';
        }

        // --- JS PARA O HERO BANNER ---
        function setupHero(data) {
            if(data.length === 0) return;
            const hero = document.getElementById('hero-featured');
            // Escolhe um canal aleatório para destaque
            const randomChannel = data[Math.floor(Math.random() * data.length)];
            
            document.getElementById('hero-channel-name').innerText = randomChannel.name;
            document.getElementById('hero-play-btn').onclick = () => playChannel(randomChannel.url);
            
            // Se o canal tiver logo, tenta usá-lo como background (com fallback)
            if(randomChannel.logo) {
                 // Uma técnica simples para tentar usar o logo como background desfocado
                 // Nota: Idealmente terias "fanart" na lista M3U, mas isto serve como fallback visual
            }
            hero.style.display = 'flex';
        }

        function loadFromFile(event) {
            const reader = new FileReader();
            reader.onload = (e) => processM3U(e.target.result);
            reader.readAsText(event.target.files[0]);
        }

        async function loadFromUrl() {
            const url = document.getElementById('m3u-url').value;
            if (!url) return;
            toggleModal(false); // Fecha modal enquanto carrega
            // Placeholder de loading podia ser adicionado aqui
            const proxy = `https://corsproxy.io/?${encodeURIComponent(url)}`;
            try {
                const response = await fetch(proxy);
                const text = await response.text();
                if(text.includes("#EXTM3U")) processM3U(text);
                else throw new Error("Inválido");
            } catch (err) {
                alert("Erro no link. Por favor usa a opção de Ficheiro Local.");
                toggleModal(true);
            }
        }

        function processM3U(text) {
            const lines = text.split(/\r?\n/);
            const channels = [];
            let current = {};
            lines.forEach(line => {
                line = line.trim();
                if (line.startsWith('#EXTINF')) {
                    const name = line.split(',')[1]?.trim() || "Canal";
                    const logo = line.match(/tvg-logo="([^"]*)"/);
                    const group = line.match(/group-title="([^"]*)"/);
                    current = { name, logo: logo ? logo[1] : '', group: group ? group[1] : 'Geral' };
                } else if (line.startsWith('http')) {
                    current.url = line;
                    channels.push(current);
                }
            });
            if(channels.length > 0) {
                allChannels = channels;
                localStorage.setItem('my_channels', JSON.stringify(allChannels));
                toggleModal(false);
                initApp(allChannels);
            } else { alert("Nenhum canal encontrado."); }
        }

        function render(data) {
            const container = document.getElementById('content');
            container.innerHTML = '';
            const groups = data.reduce((acc, ch) => {
                acc[ch.group] = acc[ch.group] || []; acc[ch.group].push(ch); return acc;
            }, {});

            Object.keys(groups).sort().forEach((group, index) => {
                const row = document.createElement('div');
                row.className = 'row';
                // Adiciona delay na animação baseado no index da linha
                row.style.animationDelay = `${0.1 + (index * 0.1)}s`; 
                row.innerHTML = `<div class="row-title">${group}</div>`;
                const carousel = document.createElement('div');
                carousel.className = 'carousel';
                groups[group].forEach(ch => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.onclick = () => playChannel(ch.url);
                    // Placeholder bonito com ícone se não houver imagem
                    const logoHtml = ch.logo ? `<img src="${ch.logo}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">` : '';
                    const placeholderHtml = `<i class="fas fa-tv placeholder-icon" style="display: ${ch.logo ? 'none' : 'flex'}"></i>`;

                    card.innerHTML = `${logoHtml}${placeholderHtml}<div class="card-info">${ch.name}</div>`;
                    carousel.appendChild(card);
                });
                row.appendChild(carousel);
                container.appendChild(row);
            });
        }

        function playChannel(url) { window.location.href = `intent:${url}#Intent;package=org.videolan.vlc;type=video/*;end`; }

        function filterChannels() {
            const query = document.getElementById('search').value.toLowerCase();
            const filtered = allChannels.filter(ch => ch.name.toLowerCase().includes(query));
            render(filtered);
            // Esconde o hero se estivermos a pesquisar
            document.getElementById('hero-featured').style.display = query ? 'none' : 'flex';
        }
    </script>
</body>
</html>
